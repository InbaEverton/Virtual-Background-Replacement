%pip install mediapipe opencv-python
%pip install numpy
%pip install opencv-python


import cv2
import mediapipe as mp
import numpy as np

# Open webcam
cap = cv2.VideoCapture(0)

# Load background image
background_img = cv2.imread(r"C:\Users\DELL\Downloads\NM\codes\NM main\backgr\pic.jpg")

# Initialize MediaPipe selfie segmentation
mp_selfie_segmentation = mp.solutions.selfie_segmentation
segmentor = mp_selfie_segmentation.SelfieSegmentation(model_selection=1)

while True:
    ret, frame = cap.read()
    if not ret:
        break

    # Flip the frame horizontally for natural selfie view
    frame = cv2.flip(frame, 1)

    # Convert frame to RGB for MediaPipe
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)

    # Get segmentation mask
    results = segmentor.process(rgb_frame)
    mask = results.segmentation_mask

    # Threshold the mask
    condition = mask > 0.6

    # Resize background to match the current frame size
    bg_resized = cv2.resize(background_img, (frame.shape[1], frame.shape[0]))

    # Combine background and frame using the condition mask
    output = np.where(condition[..., None], frame, bg_resized)

    # Display the output
    cv2.imshow("Virtual Background", output)

    # Exit on 'q' key
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# Cleanup
cap.release()
cv2.destroyAllWindows()
